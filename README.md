<div align="center">
  <img src=".assets/LenoPwn.png" alt="LenoPwn Logo" width="1200"/>
</div>

LenoPwn is a powerful replacement for the default Lenovo hotkey software, designed to give users full control over the special function keys on their laptops.

## What This Project Does

On many Lenovo laptops, certain special keys (like those for Lenovo Vantage, microphone mute, or custom functions) do not operate as standard keyboard inputs. Instead, they communicate through a custom Lenovo driver to launch specific software or perform fixed actions. This makes it difficult for users to remap or customize these keys.

LenoPwn intercepts the WMI (Windows Management Instrumentation) events generated by this custom driver. By capturing these low-level signals, it allows users to bypass the locked-down factory behavior and assign custom actions, including launching different applications, simulating complex keystrokes, or controlling hardware features.

This project is intended to completely replace the original Lenovo service responsible for this functionality, unlocking the full potential of your keyboard.

## Important Prerequisites

Before installing and using LenoPwn, you **must disable the existing Lenovo hotkey service** that may be running on your system. If the original service is active, it will conflict with LenoPwn and prevent it from working correctly.

The name of the service is: `LenovoFnAndFunctionKeys`

To disable it:
1.  Press `Win + R`, type `services.msc`, and press Enter.
2.  Locate the `LenovoFnAndFunctionKeys` service in the list.
3.  Right-click the service and select **Properties**.
4.  Change the "Startup type" to **Disabled**.
5.  Click **Stop** to terminate the service if it is running.
6.  Click **Apply** and **OK**.

Once the original service is disabled, you can proceed with the LenoPwn installation.

## Target Platform

-   **Primary Target**: Lenovo Yoga Slim 7X (ARM64)
-   **Compatibility**: May work with other Lenovo laptops (x86/x64) that support the necessary `LENOVO_UTILITY_EVENT` WMI class. This requires building from the source code.

## Features

-   **Custom Hotkey Mapping**: Assign custom actions to special function keys.
-   **Multiple Action Types**:
    -   **Launch Applications**: Open any executable, system command, or URL.
    -   **Send Keystrokes**: Simulate complex key combinations (e.g., Ctrl+C, Alt+Tab).
    -   **Special Actions**: Control hardware features like microphone/speaker mute, with LED synchronization.
-   **Visual Notifications**: Display themed popup notifications to confirm actions.
-   **Hardware LED Integration**: Synchronize the microphone and speaker mute LEDs with the actual system audio state.
-   **Theme Support**: Choose between Dark and Light themes for the notification popups.
-   **Real-time Configuration**: Changes made in the configuration UI are applied instantly without needing to restart the service.
-   **Auto-discovery**: Automatically detect and register new special function keys.

## Requirements

-   Windows 10 or Windows 11
-   .NET 8.0 Runtime
-   A Lenovo laptop with WMI support for the `LENOVO_UTILITY_EVENT` class.
-   Administrator privileges are required for installation.

## Installation

### Option 1: Installer (Recommended)

1.  Navigate to the **Releases** page of this GitHub repository.
2.  Download the latest `LenoPwn.Installer.msi` file.
3.  Run the installer with administrator privileges.
4.  Follow the on-screen instructions. The service will be installed and started automatically.
5.  You can now launch the **Configure Hotkeys** application from the Start Menu or Desktop to begin setting up your mappings.

### Option 2: Build from Source

#### Prerequisites
-   Visual Studio 2022 or later
-   .NET 8.0 SDK
-   WiX Toolset v5 (required to build the installer)

#### Build Steps
```bash
git clone [https://github.com/NexuaTCN/LenoPwn.git](https://github.com/your-username/LenoPwn.git)
cd LenoPwn
dotnet restore
dotnet build --configuration Release
```

#### Manual Installation (For Development)
```bash
# Install the service from an Administrator Command Prompt or PowerShell
sc create "LenoPwn.Service" binPath="C:\path\to\your\build\LenoPwn.Service.exe"
sc start "LenoPwn.Service"

# Add the user agent to run at startup
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "LenoPwnAgent" /d "C:\path\to\your\build\LenoPwn.Agent.exe" /f
```

## Configuration and Usage

After installation, launch the **Configure Hotkeys** application to manage your hotkey actions.

### Initial Setup and Key Discovery

1.  Open the **Configure Hotkeys** application.
2.  Click the **Rediscover Keys** button. A "Key Discovery" window will appear.
3.  Press any special function key on your Lenovo keyboard (e.g., the key with a star, the microphone mute key, etc.).
4.  When a new key is detected, a dialog will prompt you to give it a descriptive name (e.g., "Mic Mute" or "Custom F11"). This name is only for your reference in the configuration grid.
5.  Once you have registered all your desired keys, close the discovery window. The new keys will appear in the main grid, ready for configuration.

### Action Types

For each key, you can assign an action from the "Action" dropdown menu.

#### 1. Launch Application
This action allows you to execute a command, open a program, or launch a URL. The "Payload" field should contain the command or path.

-   **Open an executable:** `notepad.exe`
-   **Open a specific application by its full path:** `C:\Program Files\YourApp\app.exe`
-   **Open a website in the default browser:** `https://www.google.com`
-   **Launch a UWP application using its shell command:** `explorer.exe shell:appsFolder\Microsoft.YourPhone_8wekyb3d8bbwe!App`

#### 2. Send Keystrokes
This action simulates keyboard input.

1.  Select "Send Keystrokes" as the action.
2.  Click the **Detect** button in the "Payload" column.
3.  A "Detect Key Combination" window will appear. Press the desired key combination on your keyboard (e.g., hold `Ctrl` and press `C`).
4.  The detected combination will be displayed. Click **Accept** to save it.
5.  The payload will now be configured to send those keystrokes when the hotkey is pressed.

#### 3. Special Action
This action provides control over specific hardware-related functions. Select the desired function from the dropdown list that appears in the "Payload" column.

Available special actions include:
-   Toggle Microphone Mute
-   Toggle Speaker Mute
-   Function Lock On / Off
-   Camera On / Off
-   Keyboard Backlight Off / Low / High / Auto

### Show Pop-up
For **Special Actions**, you can check the "Show Pop-up" box to display a visual notification on screen when the action is performed.

### Saving
Click the **Save** button to apply all your changes. The service will update in the background with the new configuration.

## Project Architecture

-   **LenoPwn.Service**: A Windows service that runs in the background with SYSTEM privileges. It monitors WMI for hardware key-press events and dispatches commands.
-   **LenoPwn.Agent**: A lightweight user-space application that runs at startup. It is responsible for displaying UI notifications and simulating keystrokes in the user's active session.
-   **LenoPwn.ConfigUI**: A WPF-based graphical user interface for configuring all hotkey mappings and settings.
-   **LenoPwn.Installer**: A WiX-based installer that properly registers the service and applications.

## File Locations

-   **Configuration File**: `%LOCALAPPDATA%\LenoPwn\hotkey_map.json`
-   **Service Logs**: Windows Event Viewer → Application Logs → "LenoPwn.Service"
-   **Default Installation Directory**: `C:\Program Files\LenoPwn\`

## Troubleshooting

-   **Service Not Detecting Keys**:
    1.  Ensure you have disabled the original Lenovo hotkey service as described in the **Important Prerequisites** section.
    2.  Ensure your laptop model emits `LENOVO_UTILITY_EVENT` WMI events.
    3.  Check the Windows Event Viewer for any error messages from "LenoPwn.Service".
    4.  Confirm the service is running in the Windows Services application.
-   **Keystrokes Not Working**:
    1.  Ensure `LenoPwn.Agent.exe` is running in the Task Manager for your user.
    2.  Make sure the target application has focus when you press the hotkey.
-   **LED Sync Issues**:
    1.  Ensure the Windows audio service is running correctly.
    2.  Third-party audio control software may interfere with LED state detection.

## License

This project is licensed under the MIT License. See the LICENSE file for details.

---
**Disclaimer**: This is an unofficial, third-party tool and is not affiliated with, authorized, or endorsed by Lenovo. Use at your own risk.
